"use strict";function initializeControls(){initializeSettingsMenu(),initializePatternMenu(),$("#pause-resume-button").click(togglePauseResume),$("#next-step-button").click(function(){pause(),tick()});var e=$("#explanation");e.find("button").click(function(){e.hide()})}function initializeSettingsMenu(){initializeSettingsSliders(),initializeSettingsCheckboxes(),initializeCellColorPicker(),initializeSettingsButtons(),$(document).click(function(e){var t=$(e.target);t.closest("#menu-button").length||t.closest("#menu").length||MENU.is(":visible")&&MENU.hide()}),$("#menu-button").click(function(){MENU.show("fast")})}function initializeSettingsSliders(){var e=MENU.is(":visible")&&MENU.hasClass("no-interaction-menu--open");MENU.addClass("no-interaction-menu--open"),e||MENU.show(),(SPEED_SLIDER=new mdc.slider.MDCSlider(document.querySelector("#speed-slider"))).step=1,SPEED_SLIDER.listen("MDCSlider:input",function(){return createjs.Ticker.setFPS(SPEED_SLIDER.value)}),(DENSITY_SLIDER=new mdc.slider.MDCSlider(document.querySelector("#density-slider"))).step=1;var t=$("#density-value-display");DENSITY_SLIDER.listen("MDCSlider:input",function(){t.html(DENSITY_SLIDER.value)}),t.html(DENSITY_SLIDER.value),e||MENU.hide()}function initializeSettingsCheckboxes(){mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox")),$("#infinite-edges-checkbox").prop("checked",!1),$("#incremental-updates-checkbox").prop("checked",!1),$("#edit-cells-checkbox").prop("checked",!0)}function initializeCellColorPicker(){var e=$("#colorpicker");e.spectrum({color:DEFAULT_CELL_COLOR,showPaletteOnly:!0,showPalette:!0,hideAfterPaletteSelect:!0,palette:[["#FFEB3B","#FF9800","#F44336","#F50057"],["#2196F3","#00BCD4","#009688","#4CAF50"],["#3F51B5","#9C27B0","#673AB7","#000000"]],change:function(e){updateShapes(!0)}}),$(".sp-replacer").addClass("mdc-elevation--z3"),$(".sp-container").addClass("mdc-elevation--z3"),e.val(DEFAULT_CELL_COLOR)}function initializeSettingsButtons(){$("#create-game-button").click(function(){pause(),randomInit(DENSITY_SLIDER.value/100),MENU.hide()}),$("#clear-button").click(function(){randomInit(0),MENU.hide()})}function initializePatternMenu(){var e=$("#insert-pattern-menu").find("ul");Object.keys(PATTERNS).forEach(function(t){var i=PATTERNS[t],n=$('<li class="mdc-list-item" role="menuitem" tabindex="0"></li>');n.html(t),n.click(function(){return startInsertPatternMode(i)}),e.append(n)});var t=new mdc.menu.MDCSimpleMenu(document.querySelector("#insert-pattern-menu"));$("#insert-pattern-button").click(function(){t.open=!t.open})}function fitCanvasToGrid(){$("canvas").each(function(e,t){var i=t.getContext("2d").canvas;i.width=GRID.width(),i.height=GRID.height()})}function editCell(e){if($("#edit-cells-checkbox").prop("checked")&&!MENU.is(":visible")){var t=getMouseCellCoords(e),i=_slicedToArray(t,2),n=i[0],r=i[1],l=field.flipCell(n,r);l&&drawFieldUpdates([l])}}function startInsertPatternMode(e){stopInsertPatternMode(),GRID_SELECTOR.off("click.editCell"),GRID_SELECTOR.mousemove(function(t){var i=getMouseCellCoords(t),n=_slicedToArray(i,2),r=n[0],l=n[1];showPatternPreview(e,r,l)}),GRID_SELECTOR.on("click.insertPattern",function(t){var i=getMouseCellCoords(t),n=_slicedToArray(i,2),r=n[0],l=n[1];drawFieldUpdates(field.setPattern(e,r,l)),stopInsertPatternMode()})}function stopInsertPatternMode(){hidePatternPreview(),GRID_SELECTOR.off("mousemove"),GRID_SELECTOR.off("click.insertPattern"),GRID_SELECTOR.on("click.editCell",editCell)}function getMouseCellCoords(e){var t=GRID_SELECTOR.offset(),i=e.pageX-t.left,n=e.pageY-t.top;return[Math.floor(n/cellSize),Math.floor(i/cellSize)]}function showPatternPreview(e,t,i){hidePatternPreview();var n=shapes.length,r=shapes[0].length,l=!0,o=!1,a=void 0;try{for(var c,s=e[Symbol.iterator]();!(l=(c=s.next()).done);l=!0){var d=c.value,u=d[0]+t,S=d[1]+i;if(!(u>=n||u<0||S>=r||S<0)){var h=getCellShape(S,u,PATTERN_PREVIEW_COLOR);STAGE.addChildAt(h,0),patternPreviewShapes.push(h)}}}catch(e){o=!0,a=e}finally{try{!l&&s.return&&s.return()}finally{if(o)throw a}}STAGE.update()}function hidePatternPreview(){var e=!0,t=!1,i=void 0;try{for(var n,r=patternPreviewShapes[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var l=n.value;STAGE.removeChild(l)}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}}function pause(){createjs.Ticker.paused||togglePauseResume()}function togglePauseResume(){var e=$("#pause-resume-button");createjs.Ticker.paused=!createjs.Ticker.paused;var t=createjs.Ticker.paused?"play_arrow":"pause";e.find(".material-icons").first().html(t)}function getSelectedGridRows(){return parseFloat(GRID_SELECTOR.attr("data-rows"))}function getSelectedGridColumns(){return parseFloat(GRID_SELECTOR.attr("data-columns"))}function initializeGridSelector(){alignGridSelector(1/0,1/0),interact("#grid-selector").resizable({edges:{left:!1,right:".resize-hook-right",bottom:".resize-hook-bottom",top:!1}}).on("resizemove",function(e){e.rect.right>=GRID.width()-getMarginCells()*cellSize&&e.rect.bottom>=GRID.height()-getMarginCells()*cellSize&&increaseGrid();var t=Math.round(GRID_SELECTOR.position().left/cellSize),i=Math.round(GRID_SELECTOR.position().top/cellSize);alignGridSelector(e.rect.right/cellSize-t,e.rect.bottom/cellSize-i)}).on("resizeend",function(){fitGrid()})}function increaseGrid(){var e=Math.max(.9*cellSize,4);cellSize!=e&&(updateCellSize(e),updateShapes())}function updateCellSize(e){var t="dist/img/grid32@2x.png";8<(cellSize=Math.round(10*e)/10)&&cellSize<=16?t="dist/img/grid16@2x.png":4<cellSize&&cellSize<=8?t="dist/img/grid8@2x.png":cellSize<=4&&(t="dist/img/grid4@2x.png");var i=10*cellSize+"px "+10*cellSize+"px";GRID.css("background-size",i),GRID.css("background-image",'url("'+t+'")')}function fitGrid(){for(var e=getSelectedGridColumns(),t=getSelectedGridRows(),i=cellSize;t<getMaxGridRows(i)&&e<getMaxGridColumns(i);)i*=1.01;updateCellSize(i),alignGridSelector(e,t),updateFieldSize()}function getMaxGridColumns(e){return e=void 0!==e?e:cellSize,Math.floor(GRID.width()/e)-2*getMarginCells(e)}function getMaxGridRows(e){return e=void 0!==e?e:cellSize,Math.floor(GRID.height()/e)-2*getMarginCells(e)}function getMarginCells(e){return e=void 0!==e?e:cellSize,Math.ceil(MIN_GRID_MARGIN/e)}function alignGridSelector(e,t){void 0===e&&(e=getSelectedGridColumns()),void 0===t&&(t=getSelectedGridRows()),e=Math.max(e,5),t=Math.max(t,5),e=Math.min(getMaxGridColumns(),e),t=Math.min(getMaxGridRows(),t);var i=Math.round(e),n=Math.round(t);GRID_SELECTOR.attr("data-columns",i),GRID_SELECTOR.attr("data-rows",n),updateGridSelector(i*cellSize,n*cellSize)}function updateGridSelector(e,t,i,n){var r=getMarginCells()*cellSize;i=void 0!==i?i:r,n=void 0!==n?n:r,GRID_SELECTOR.width(e),GRID_SELECTOR.height(t),GRID_SELECTOR.css({left:i,top:n}),GRID_SELECTOR_SIBLINGS.top.css({top:0,right:0,left:0}),GRID_SELECTOR_SIBLINGS.top.height(n),GRID_SELECTOR_SIBLINGS.bottom.css({top:n+t,right:0,bottom:0,left:0}),GRID_SELECTOR_SIBLINGS.left.css({top:n,left:0}),GRID_SELECTOR_SIBLINGS.left.width(i),GRID_SELECTOR_SIBLINGS.left.height(t),GRID_SELECTOR_SIBLINGS.right.css({top:n,right:0,left:i+e}),GRID_SELECTOR_SIBLINGS.right.height(t)}function tick(){var e=$("#infinite-edges-checkbox").prop("checked"),t=$("#incremental-updates-checkbox").prop("checked");drawFieldUpdates(field.step(e,t))}function drawField(){field.forEach(function(e,t,i){shapes[e][t].visible=i}),STAGE.update()}function drawFieldUpdates(e){var t=!0,i=!1,n=void 0;try{for(var r,l=e[Symbol.iterator]();!(t=(r=l.next()).done);t=!0){var o=r.value;shapes[o.row][o.column].visible=o.isAlive}}catch(e){i=!0,n=e}finally{try{!t&&l.return&&l.return()}finally{if(i)throw n}}STAGE.update()}function randomInit(e){updateFieldSize(),field.randomInit(e),drawField()}function updateFieldSize(){var e=getSelectedGridRows(),t=getSelectedGridColumns();field.updateSize(e,t),updateShapes()}function updateShapes(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=getSelectedGridRows(),i=getSelectedGridColumns();if(e||shapes.length!=t||shapes[0].length!=i){shapes=[],STAGE.removeAllChildren();for(var n=0;n<t;n++){for(var r=[],l=0;l<i;l++){var o=getCellShape(l,n,$("#colorpicker").val()||DEFAULT_CELL_COLOR);o.visible=!1,STAGE.addChild(o),r.push(o)}shapes.push(r)}drawField()}}function getCellShape(e,t,i){var n=getMarginCells(),r=new createjs.Shape;return r.graphics.beginFill(i).drawRect((e+n)*cellSize,(t+n)*cellSize,cellSize,cellSize),r}var _slicedToArray=function(){function e(e,t){var i=[],n=!0,r=!1,l=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);n=!0);}catch(e){r=!0,l=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw l}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),DEFAULT_CELL_COLOR="#3F51B5",PATTERN_PREVIEW_COLOR="#5fb4b5",MIN_GRID_MARGIN=10,STAGE=null,GRID=null,GRID_SELECTOR=null,GRID_SELECTOR_SIBLINGS={top:null,right:null,bottom:null,left:null},MENU=null,DENSITY_SLIDER=null,SPEED_SLIDER=null,cellSize=12,field=null,shapes=[],patternPreviewShapes=[];$(function(){STAGE=new createjs.Stage("canvas"),GRID=$("#grid"),GRID_SELECTOR=$("#grid-selector"),GRID_SELECTOR_SIBLINGS.top=$("#grid-selector-top"),GRID_SELECTOR_SIBLINGS.right=$("#grid-selector-right"),GRID_SELECTOR_SIBLINGS.bottom=$("#grid-selector-bottom"),GRID_SELECTOR_SIBLINGS.left=$("#grid-selector-left"),MENU=$("#menu"),fitCanvasToGrid(),updateCellSize(cellSize),initializeGridSelector(),initializeControls();var e=getSelectedGridRows(),t=getSelectedGridColumns();field=new Field(e,t),$(window).resize(function(){clearTimeout(window.resizePaused),window.resizePaused=setTimeout(function(){fitCanvasToGrid(),alignGridSelector(),updateFieldSize(),initializeSettingsSliders()},250)}),GRID_SELECTOR.on("click.editCell",editCell),randomInit(DENSITY_SLIDER.value/100),createjs.Ticker.addEventListener("tick",function(e){e.paused||tick()}),createjs.Ticker.setFPS(SPEED_SLIDER.value)});